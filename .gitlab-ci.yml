image: continuumio/miniconda3:latest

stages:
  - test

test:
  stage: test
  # tags:
  #   - linux

  script:
    - conda install mamba -c conda-forge
    - mamba create -n glaes
    - source activate glaes
    - git clone --branch dev https://CIGlaes:${GeokitAccessToken}@jugit.fz-juelich.de/iek-3/shared-code/geokit.git
    - cd geokit
    - mamba env update -n glaes --file=requirements.yml
    - cd ..
    - mamba env update -n glaes --file=requirements.yml
    - cd geokit
    - pip install -e . --no-deps
    - cd ..
    - pip install -e . --no-deps
    - pytest --cov=glaes glaes/test/

